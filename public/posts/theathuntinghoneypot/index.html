<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article" data-r-output-format="html">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.142.0">
    <meta name="generator" content="Relearn 8.0.0+9803d5122ebb3276acea823f476e9eb44f607862">
    <meta name="description" content="Introduction What is Cowrie? Key capabilities of Cowrie include: Why Podman over Docker? Install cowrie as container and adjust configuration ğŸ§ Create a Dedicated User for Cowrie (No Login Shell) ğŸ³ Pull and Configure Cowrie with Podman ğŸ›  cowrie.cfg â€“ Basic Overview ğŸš€ Run Cowrie Container as â€˜cowrieâ€™ User ğŸ” Useful Commands ğŸ”’ Security Notes Log Forwarding with Filebeat ğŸ“¦ Install Filebeat on Ubuntu âš™ Configure and test Filebeat ğŸš€ Start and Enable Filebeat ğŸ¯ TL;DR â€“ What Did We Just Do? Introduction This post provides a brief walkthrough of how to deploy a lightweight, containerized SSH honeypot using Cowrie and Podman, with the goal of capturing and analyzing malicious activity as part of my threat hunting strategy.">
    <meta name="author" content="Dirk">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Threat hunting II: SSH Honeypot setup - Forensic wheels">
    <meta name="twitter:description" content="Introduction What is Cowrie? Key capabilities of Cowrie include: Why Podman over Docker? Install cowrie as container and adjust configuration ğŸ§ Create a Dedicated User for Cowrie (No Login Shell) ğŸ³ Pull and Configure Cowrie with Podman ğŸ›  cowrie.cfg â€“ Basic Overview ğŸš€ Run Cowrie Container as â€˜cowrieâ€™ User ğŸ” Useful Commands ğŸ”’ Security Notes Log Forwarding with Filebeat ğŸ“¦ Install Filebeat on Ubuntu âš™ Configure and test Filebeat ğŸš€ Start and Enable Filebeat ğŸ¯ TL;DR â€“ What Did We Just Do? Introduction This post provides a brief walkthrough of how to deploy a lightweight, containerized SSH honeypot using Cowrie and Podman, with the goal of capturing and analyzing malicious activity as part of my threat hunting strategy.">
    <meta property="og:url" content="http://localhost:1313/posts/theathuntinghoneypot/index.html">
    <meta property="og:site_name" content="Forensic wheels">
    <meta property="og:title" content="Threat hunting II: SSH Honeypot setup - Forensic wheels">
    <meta property="og:description" content="Introduction What is Cowrie? Key capabilities of Cowrie include: Why Podman over Docker? Install cowrie as container and adjust configuration ğŸ§ Create a Dedicated User for Cowrie (No Login Shell) ğŸ³ Pull and Configure Cowrie with Podman ğŸ›  cowrie.cfg â€“ Basic Overview ğŸš€ Run Cowrie Container as â€˜cowrieâ€™ User ğŸ” Useful Commands ğŸ”’ Security Notes Log Forwarding with Filebeat ğŸ“¦ Install Filebeat on Ubuntu âš™ Configure and test Filebeat ğŸš€ Start and Enable Filebeat ğŸ¯ TL;DR â€“ What Did We Just Do? Introduction This post provides a brief walkthrough of how to deploy a lightweight, containerized SSH honeypot using Cowrie and Podman, with the goal of capturing and analyzing malicious activity as part of my threat hunting strategy.">
    <meta property="og:locale" content="en_us">
    <meta property="og:type" content="article">
    <meta property="article:section" content="Forensic wheels">
    <meta property="article:published_time" content="2025-07-13T07:38:00+02:00">
    <meta property="article:modified_time" content="2025-07-21T11:53:31+02:00">
    <meta property="article:tag" content="Threathunting">
    <meta property="article:tag" content="Honeypot">
    <meta itemprop="name" content="Threat hunting II: SSH Honeypot setup - Forensic wheels">
    <meta itemprop="description" content="Introduction What is Cowrie? Key capabilities of Cowrie include: Why Podman over Docker? Install cowrie as container and adjust configuration ğŸ§ Create a Dedicated User for Cowrie (No Login Shell) ğŸ³ Pull and Configure Cowrie with Podman ğŸ›  cowrie.cfg â€“ Basic Overview ğŸš€ Run Cowrie Container as â€˜cowrieâ€™ User ğŸ” Useful Commands ğŸ”’ Security Notes Log Forwarding with Filebeat ğŸ“¦ Install Filebeat on Ubuntu âš™ Configure and test Filebeat ğŸš€ Start and Enable Filebeat ğŸ¯ TL;DR â€“ What Did We Just Do? Introduction This post provides a brief walkthrough of how to deploy a lightweight, containerized SSH honeypot using Cowrie and Podman, with the goal of capturing and analyzing malicious activity as part of my threat hunting strategy.">
    <meta itemprop="datePublished" content="2025-07-13T07:38:00+02:00">
    <meta itemprop="dateModified" content="2025-07-21T11:53:31+02:00">
    <meta itemprop="wordCount" content="1064">
    <meta itemprop="keywords" content="Threathunting,Honeypot">
    <title>Threat hunting II: SSH Honeypot setup - Forensic wheels</title>
    <link href="/images/logo.svg?1753094648" rel="icon" type="image/svg+xml">
    <link href="/css/auto-complete/auto-complete.min.css?1753094648" rel="stylesheet">
    <script src="/js/auto-complete/auto-complete.min.js?1753094648" defer></script>
    <script src="/js/search-lunr.js?1753094648" defer></script>
    <script src="/js/search.js?1753094648" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.index_js_url="/searchindex.en.js?1753094648";
    </script>
    <script src="/js/lunr/lunr.min.js?1753094648" defer></script>
    <script src="/js/lunr/lunr.stemmer.support.min.js?1753094648" defer></script>
    <script src="/js/lunr/lunr.multi.min.js?1753094648" defer></script>
    <script src="/js/lunr/lunr.en.min.js?1753094648" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.contentLangs=['en'];
    </script>
    <link href="/fonts/fontawesome/css/fontawesome-all.min.css?1753094648" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/fonts/fontawesome/css/fontawesome-all.min.css?1753094648" rel="stylesheet"></noscript>
    <link href="/css/perfect-scrollbar/perfect-scrollbar.min.css?1753094648" rel="stylesheet">
    <link href="/css/theme.css?1753094648" rel="stylesheet">
    <link href="/css/format-html.css?1753094648" rel="stylesheet" id="R-format-style">
    <script>
      window.relearn = window.relearn || {};
      // configuration
      window.relearn.min = ``;
      window.relearn.path='\/posts\/theathuntinghoneypot\/index.html';
      window.relearn.relBasePath='..\/..';
      window.relearn.relBaseUri='..\/..';
      window.relearn.absBaseUri='http:\/\/localhost:1313';
      window.relearn.disableAnchorCopy=false;
      window.relearn.disableAnchorScrolling=false;
      window.relearn.disableInlineCopyToClipboard=false;
      window.relearn.enableBlockCodeWrap=true;
      // legal
      window.relearn.getItem = (s,n) => {return s.getItem(n)};
      window.relearn.setItem = (s,n,v) => {return s.setItem(n,v)};
      window.relearn.removeItem = (s,n) => {return s.removeItem(n)};
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
      // variant stuff
      window.relearn.themevariants = [ 'auto', 'neon' ];
      window.relearn.customvariantname = "my-custom-variant";
      window.relearn.changeVariant = function(variant) {
        var oldVariant = document.documentElement.dataset.rThemeVariant;
        window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        document.documentElement.dataset.rThemeVariant = variant;
        if (oldVariant != variant) {
          document.dispatchEvent( new CustomEvent('themeVariantLoaded', { detail: { variant, oldVariant } }) );
          window.relearn.markVariant();
        }
      }
      window.relearn.markVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant");
        document.querySelectorAll(".R-variantswitcher select").forEach((select) => {select.value = variant;});
      }
      window.relearn.initVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant") ?? "";
        if( variant == window.relearn.customvariantname ){
        }else if( !variant || !window.relearn.themevariants.includes(variant) ){
          variant = window.relearn.themevariants[0];
          window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        }
        document.documentElement.dataset.rThemeVariant = variant;
      }
      window.relearn.initVariant();
      window.relearn.markVariant();
    </script>
  </head>
  <body class="mobile-support html" data-url="/posts/theathuntinghoneypot/index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>
            <div class="topbar-button topbar-button-toc" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="Table of Contents (CTRL&#43;ALT&#43;t)"><i class="fa-fw fas fa-list-alt"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
<nav class="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#what-is-cowrie">What is Cowrie?</a>
      <ul>
        <li><a href="#key-capabilities-of-cowrie-include">Key capabilities of Cowrie include:</a></li>
      </ul>
    </li>
    <li><a href="#why-podman-over-docker">Why Podman over Docker?</a></li>
    <li><a href="#install-cowrie-as-container-and-adjust-configuration">Install cowrie as container and adjust configuration</a>
      <ul>
        <li><a href="#create-a-dedicated-user-for-cowrie--no-login-shell">ğŸ§ Create a Dedicated User for Cowrie (No Login Shell)</a></li>
        <li><a href="#pull-and-configure-cowrie-with-podman">ğŸ³ Pull and Configure Cowrie with Podman</a></li>
        <li><a href="#cowrie-dot-cfg-basic-overview">ğŸ›  cowrie.cfg â€“ Basic Overview</a></li>
        <li><a href="#run-cowrie-container-as-cowrie-user">ğŸš€ Run Cowrie Container as &lsquo;cowrie&rsquo; User</a></li>
        <li><a href="#useful-commands">ğŸ” Useful Commands</a></li>
        <li><a href="#security-notes">ğŸ”’ Security Notes</a></li>
      </ul>
    </li>
    <li><a href="#log-forwarding-with-filebeat">Log Forwarding with Filebeat</a>
      <ul>
        <li><a href="#install-filebeat-on-ubuntu">ğŸ“¦ Install Filebeat on Ubuntu</a></li>
        <li><a href="#configure-and-test-filebeat">âš™ Configure and test Filebeat</a></li>
        <li><a href="#start-and-enable-filebeat">ğŸš€ Start and Enable Filebeat</a></li>
      </ul>
    </li>
    <li><a href="#tl-dr-what-did-we-just-do">ğŸ¯ TL;DR â€“ What Did We Just Do?</a></li>
  </ul>
</nav>
                </div>
              </div>
            </div>
          </div>
          <span class="topbar-breadcrumbs highlightable">
            Threat hunting II: SSH Honeypot setup
          </span>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-more" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="More"><i class="fa-fw fas fa-ellipsis-v"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
                  <div class="topbar-area topbar-area-more" data-area="more">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable posts" tabindex="-1">
        <div class="flex-block-wrapper">
<article class="default">
  <header class="headline">
<div class="R-taxonomy taxonomy-tags cstyle tags" title="Tags" style="--VARIABLE-TAGS-BG-color: var(--INTERNAL-TAG-BG-color);">
  <ul>
    <li><a class="term-link" href="/tags/honeypot/index.html">Honeypot</a></li>
    <li><a class="term-link" href="/tags/threathunting/index.html">Threathunting</a></li>
  </ul>
</div>
  </header>

<h1 id="threat-hunting-ii-ssh-honeypot-setup">Threat hunting II: SSH Honeypot setup</h1>

<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<ul>
<li><a href="/posts/theathuntinghoneypot/index.html#introduction">Introduction</a></li>
<li><a href="/posts/theathuntinghoneypot/index.html#what-is-cowrie">What is Cowrie?</a>
<ul>
<li><a href="/posts/theathuntinghoneypot/index.html#key-capabilities-of-cowrie-include">Key capabilities of Cowrie include:</a></li>
</ul>
</li>
<li><a href="/posts/theathuntinghoneypot/index.html#why-podman-over-docker">Why Podman over Docker?</a></li>
<li><a href="/posts/theathuntinghoneypot/index.html#install-cowrie-as-container-and-adjust-configuration">Install cowrie as container and adjust configuration</a>
<ul>
<li><a href="/posts/theathuntinghoneypot/index.html#create-a-dedicated-user-for-cowrie--no-login-shell">ğŸ§ Create a Dedicated User for Cowrie (No Login Shell)</a></li>
<li><a href="/posts/theathuntinghoneypot/index.html#pull-and-configure-cowrie-with-podman">ğŸ³ Pull and Configure Cowrie with Podman</a></li>
<li><a href="/posts/theathuntinghoneypot/index.html#cowrie-dot-cfg-basic-overview">ğŸ›  cowrie.cfg â€“ Basic Overview</a></li>
<li><a href="/posts/theathuntinghoneypot/index.html#run-cowrie-container-as-cowrie-user">ğŸš€ Run Cowrie Container as &lsquo;cowrie&rsquo; User</a></li>
<li><a href="/posts/theathuntinghoneypot/index.html#useful-commands">ğŸ” Useful Commands</a></li>
<li><a href="/posts/theathuntinghoneypot/index.html#security-notes">ğŸ”’ Security Notes</a></li>
</ul>
</li>
<li><a href="/posts/theathuntinghoneypot/index.html#log-forwarding-with-filebeat">Log Forwarding with Filebeat</a>
<ul>
<li><a href="/posts/theathuntinghoneypot/index.html#install-filebeat-on-ubuntu">ğŸ“¦ Install Filebeat on Ubuntu</a></li>
<li><a href="/posts/theathuntinghoneypot/index.html#configure-and-test-filebeat">âš™ Configure and test Filebeat</a></li>
<li><a href="/posts/theathuntinghoneypot/index.html#start-and-enable-filebeat">ğŸš€ Start and Enable Filebeat</a></li>
</ul>
</li>
<li><a href="/posts/theathuntinghoneypot/index.html#tl-dr-what-did-we-just-do">ğŸ¯ TL;DR â€“ What Did We Just Do?</a></li>
</ul>
<!-- raw HTML omitted -->
<h2 id="introduction">Introduction</h2>
<p>This post provides a brief walkthrough of how to deploy a lightweight,
containerized SSH honeypot using Cowrie and Podman, with the goal of
capturing and analyzing malicious activity as part of my threat hunting
strategy.</p>
<h2 id="what-is-cowrie">What is Cowrie?</h2>
<p>Cowrie is an interactive SSH and Telnet honeypot designed to emulate a
real system, capturing attacker behavior in a controlled environment.
It allows defenders and researchers to observe malicious activity without
exposing actual infrastructure.</p>
<h3 id="key-capabilities-of-cowrie-include">Key capabilities of Cowrie include:</h3>
<ul>
<li>
<p><strong>Full session logging</strong>: Records all commands entered by the attacker,
along with input/output streams and timing data. Sessions can be saved
as plaintext or in formats suitable for replay.</p>
</li>
<li>
<p><strong>Fake file system and shell environment</strong>: Emulates a basic Linux shell
with a user-modifiable file system. Attackers can navigate directories,
read/write fake files, or attempt to download/upload payloads.</p>
</li>
<li>
<p><strong>Command emulation</strong>: Supports a large set of common Unix commands (`ls`,
`cat`, `wget`, etc.), allowing attackers to interact naturally, as
if on a real system. And can be extended with more commands</p>
</li>
<li>
<p><strong>Credential logging</strong>: Captures usernames and passwords used in
brute-force login attempts or interactive logins.</p>
</li>
<li>
<p><strong>File download capture</strong>: Logs and optionally stores any files attackers
attempt to retrieve via `wget`, `curl`, or similar tools.</p>
</li>
<li>
<p><strong>JSON-formatted logging and integration&rsquo;s</strong>: Outputs structured logs that
are easy to parse and ingest into systems like ELK, Splunk, or custom
analysis pipelines.</p>
</li>
</ul>
<p>Cowrie is widely used in research, threat intelligence, and proactive defense
efforts to gather Indicators of Compromise (IOCs) and understand attacker
tactics,techniques, and procedures (TTPs).</p>
<h2 id="why-podman-over-docker">Why Podman over Docker?</h2>
<p>Podman offers several advantages over Docker, particularly in terms of security
and system integration. It supports rootless containers, allowing users to run
containers without elevated privileges, which reduces the attack surface.</p>
<p>Podman is daemon-less, integrating more seamlessly with systemd and existing
Linux workflows. Additionally, Podman is fully compatible with the Open
Container Initiative (OCI) standards, ensuring interoperability and
flexibility across container ecosystems.</p>
<h2 id="install-cowrie-as-container-and-adjust-configuration">Install cowrie as container and adjust configuration</h2>
<h3 id="create-a-dedicated-user-for-cowrie--no-login-shell">ğŸ§ Create a Dedicated User for Cowrie (No Login Shell)</h3>
<p><strong><strong>1. Create the &lsquo;cowrie&rsquo; user (no home directory, no login shell)</strong></strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>sudo useradd --system --no-create-home --shell /usr/sbin/nologin cowrie</span></span></code></pre></div>
<p><strong><strong>2. Create necessary directories and set ownership</strong></strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>sudo mkdir -p /opt/cowrie/etc
</span></span><span style="display:flex;"><span>sudo mkdir -p /opt/cowrie/var
</span></span><span style="display:flex;"><span>sudo chown -R cowrie:cowrie /opt/cowrie</span></span></code></pre></div>
<h3 id="pull-and-configure-cowrie-with-podman">ğŸ³ Pull and Configure Cowrie with Podman</h3>
<p><strong><strong>3. As the cowrie user, pull the container image</strong></strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo -u cowrie podman pull cowrie/cowrie</span></span></code></pre></div>
<p><strong><strong>4. Copy default config file into persistent volume</strong></strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo -u cowrie podman run --rm cowrie/cowrie <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  cat /cowrie/cowrie-git/etc/cowrie.cfg.dist &gt; /opt/cowrie/etc/cowrie.cfg</span></span></code></pre></div>
<h3 id="cowrie-dot-cfg-basic-overview">ğŸ›  cowrie.cfg â€“ Basic Overview</h3>
<p>The `cowrie.cfg` file is the main configuration for <strong><strong>Cowrie</strong></strong>, the SSH/Telnet
honeypot we use. It uses INI-style syntax and is divided into sections. Each section
begins with a header like <strong>[section_name]</strong>.</p>
<ul>
<li>
<p>ğŸ“ Key Sections &amp; Settings</p>
<p><strong><strong>[ssh] / [telnet]</strong></strong></p>
<ul>
<li>Enable or disable SSH/Telnet and set the port to listen on::
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>enabled <span style="color:#f92672">=</span> true
</span></span><span style="display:flex;"><span>listen_port <span style="color:#f92672">=</span> <span style="color:#ae81ff">2222</span></span></span></code></pre></div>
</li>
</ul>
<p><strong><strong>[honeypot]</strong></strong></p>
<ul>
<li>
<p>Set honeypot host name and logpath properties:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>hostname <span style="color:#f92672">=</span> cowrie-host
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Directory where to save log files in.</span>
</span></span><span style="display:flex;"><span>log_path <span style="color:#f92672">=</span> var/log/cowrie</span></span></code></pre></div>
</li>
<li>
<p>Define login behavior:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>auth_class <span style="color:#f92672">=</span> AuthRandom
</span></span><span style="display:flex;"><span>auth_class_parameters <span style="color:#f92672">=</span> 1, 5, <span style="color:#ae81ff">10</span></span></span></code></pre></div>
<p>I use AuthRandom here which causes to allow access after &ldquo;randint(2,5)&rdquo;
attempts. This means the threat actor will fail with some logins and some
will be logged in immediately.</p>
</li>
</ul>
<p><strong><strong>[output_jsonlog]</strong></strong></p>
<ul>
<li>Configure logging and output plugins:
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f92672">[</span>output_jsonlog<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>enabled <span style="color:#f92672">=</span> true
</span></span><span style="display:flex;"><span>logfile <span style="color:#f92672">=</span> <span style="color:#e6db74">${</span>honeypot:log_path<span style="color:#e6db74">}</span>/cowrie.json
</span></span><span style="display:flex;"><span>epoch_timestamp <span style="color:#f92672">=</span> false</span></span></code></pre></div>
Here I set the log file path, this is important so that file beat later can
pickup on the juicy honeypot log files.</li>
</ul>
<p>This is the whole configuration needed to run the honeypot.</p>
<p><!-- raw HTML omitted -->ğŸ“Œ Notes<!-- raw HTML omitted --></p>
<ul>
<li>Restart Cowrie after configuration changes.</li>
<li>You can split configuration across multiple `.cfg` files in `cowrie.cfg.d/` for modular setup.</li>
</ul>
</li>
</ul>
<h3 id="run-cowrie-container-as-cowrie-user">ğŸš€ Run Cowrie Container as &lsquo;cowrie&rsquo; User</h3>
<p><strong><strong>Start the Cowrie container (replace existing if needed)</strong></strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo -u cowrie podman run -d --name cowrie <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -v /opt/cowrie/etc:/cowrie/cowrie-git/etc:Z <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -v /opt/cowrie/var:/cowrie/cowrie-git/var:Z <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -p 2222:2222 cowrie/cowrie</span></span></code></pre></div>
<h3 id="useful-commands">ğŸ” Useful Commands</h3>
<ul>
<li>
<p><strong><strong>View logs</strong></strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo -u cowrie podman logs -f cowrie</span></span></code></pre></div>
</li>
<li>
<p><strong><strong>Restart container</strong></strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo -u cowrie podman restart cowrie</span></span></code></pre></div>
</li>
<li>
<p><strong><strong>Stop container</strong></strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo -u cowrie podman stop cowrie</span></span></code></pre></div>
</li>
</ul>
<h3 id="security-notes">ğŸ”’ Security Notes</h3>
<ul>
<li>The `cowrie` user has no login shell (`/usr/sbin/no login`)</li>
<li>Running Cowrie isolated via Podman increases containment</li>
<li>All files are owned by `cowrie`, no root access required for normal operation</li>
</ul>
<h2 id="log-forwarding-with-filebeat">Log Forwarding with Filebeat</h2>
<h3 id="install-filebeat-on-ubuntu">ğŸ“¦ Install Filebeat on Ubuntu</h3>
<p><strong><strong>1. Add Elasticâ€™s GPG key and repository</strong></strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -fsSL https://artifacts.elastic.co/GPG-KEY-elasticsearch | sudo gpg --dearmor -o /usr/share/keyrings/elastic.gpg
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;deb [signed-by=/usr/share/keyrings/elastic.gpg] https://artifacts.elastic.co/packages/8.x/apt stable main&#34;</span> | <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  sudo tee /etc/apt/sources.list.d/elastic-8.x.list</span></span></code></pre></div>
<p><strong><strong>2. Update APT and install Filebeat</strong></strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo apt update
</span></span><span style="display:flex;"><span>sudo apt install filebeat</span></span></code></pre></div>
<h3 id="configure-and-test-filebeat">âš™ Configure and test Filebeat</h3>
<p><strong><strong>3. Edit Filebeat config</strong></strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo mg /etc/filebeat/filebeat.yml</span></span></code></pre></div>
<p>The filebeat config is straight forward. You have to write a filebeat.input
block which contains the path where the logfiles are you need to ingest. And
at the end the log-destination (logstash) so that filebeat knows where to send
the logs to:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">filebeat.inputs</span>:
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">type</span>: <span style="color:#ae81ff">log</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">paths</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">/opt/cowrie/var/log/cowrie/cowrie.json</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">json.keys_under_root</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">json.add_error_key</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">fields</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">source</span>: <span style="color:#ae81ff">cowrie</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">fields_under_root</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">output.logstash</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">hosts</span>: [<span style="color:#e6db74">&#34;192.168.123.5:5044&#34;</span>]</span></span></code></pre></div>
<p><strong><strong>4. (Optional) Test Filebeat config</strong></strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo filebeat test config</span></span></code></pre></div>
<h3 id="start-and-enable-filebeat">ğŸš€ Start and Enable Filebeat</h3>
<p><strong><strong>5. Enable and start Filebeat</strong></strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo systemctl enable filebeat
</span></span><span style="display:flex;"><span>sudo systemctl daemon-reload
</span></span><span style="display:flex;"><span>sudo systemctl start filebeat</span></span></code></pre></div>
<p><strong><strong>6. Check Filebeat status and logs</strong></strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo systemctl status filebeat
</span></span><span style="display:flex;"><span>sudo journalctl -u filebeat -f</span></span></code></pre></div>
<h2 id="tl-dr-what-did-we-just-do">ğŸ¯ TL;DR â€“ What Did We Just Do?</h2>
<p><strong><strong>1. We deployed Cowrie like pros.</strong></strong></p>
<ul>
<li>Ran it safely in a Podman container under a non-login user.</li>
<li>No mess, no root, no regrets.</li>
</ul>
<p><strong><strong>2. Logs? Sorted.</strong></strong></p>
<ul>
<li>Filebeat scooped up Cowrieâ€™s logs and shipped them to Elasticsearch.</li>
<li>Now we can actually <strong>see</strong> who&rsquo;s knocking on the honeypot door.</li>
</ul>
<p><strong><strong>3. Everythingâ€™s persistent.</strong></strong></p>
<ul>
<li>Configs and logs live outside the container. Cowrie forgets nothingâ€”even after a reboot.</li>
</ul>
<p><strong><strong>4. Setup is clean and modular.</strong></strong></p>
<ul>
<li>Each part (Cowrie, Filebeat, Elasticsearch) does its job.</li>
<li>Break one, fix oneâ€”no domino disasters.</li>
</ul>
<p><strong><strong>5. Itâ€™s nerdy, useful, and kinda fun.</strong></strong></p>
<ul>
<li>Congrats, you built a mini threat intel system.</li>
<li>Now sit back, sip coffee, and watch the script kiddies play.</li>
</ul>
<div id="giscus-comments" style="margin-top: 2rem;">
    <script src="https://giscus.app/client.js"
            data-repo="PolymathMonkey/weblog"
            data-repo-id="R_kgDOOvWS_g"
            data-category="General"
            data-category-id="DIC_kwDOOvWS_s4CsdWD"
            data-mapping="pathname"
            data-theme="dark"
            crossorigin="anonymous"
            async>
    </script>
</div>


  <footer class="footline">
              <i class='fa-fw fas fa-calendar'></i> Jul 13, 2025
<div class="R-taxonomy taxonomy-categories cstyle" title="Categories" style="--VARIABLE-TAGS-BG-color: var(--INTERNAL-TAG-BG-color);">
  <i class="fa-fw fas fa-layer-group"></i>
  <ul>
    <li><a class="term-link" href="/categories/threathunting/index.html">Threathunting</a></li>
  </ul>
</div>
  </footer>
</article>
        </div>
      </main>
    </div>
    <aside id="R-sidebar" class="default-animation">
      <div id="R-header-topbar" class="default-animation"></div>
      <div id="R-header-wrapper" class="default-animation">
        <div id="R-header" class="default-animation">
          <a id="R-logo" class="R-default" href="/index.html">
            <div class="logo-title">Forensic wheels</div>
          </a>
        </div>
        <search><form action="/search/index.html" method="get">
          <div class="searchbox default-animation">
            <button class="search-detail" type="submit" title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
            <label class="a11y-only" for="R-search-by">Search</label>
            <input data-search-input id="R-search-by" name="search-by" class="search-by" type="search" placeholder="Search...">
            <button class="search-clear" type="button" data-search-clear="" title="Clear search"><i class="fas fa-times" title="Clear search"></i></button>
          </div>
        </form></search>
      </div>
      <div id="R-homelinks" class="default-animation">
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-homelinks">
          <ul class="space collapsible-menu">
          </ul>
        </div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-headercontrols">
          <ul class="">
          </ul>
        </div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
      </div>
      <div id="R-content-wrapper" class="highlightable">
        <div class="R-sidebarmenu R-shortcutmenu-main">
          <ul class="enlarge morespace collapsible-menu">
            <li class="parent " data-nav-id="/posts/index.html"><a class="padding" href="/posts/index.html">Forensic wheels</a><ul id="R-subsections-b4e55eb7e39db1aee6d02808a2267090" class="collapsible-menu">
            <li class="" data-nav-id="/posts/threathuntingnet/index.html"><a class="padding" href="/posts/threathuntingnet/index.html">Threathunting I: Network setup</a></li>
            <li class="active " data-nav-id="/posts/theathuntinghoneypot/index.html"><a class="padding" href="/posts/theathuntinghoneypot/index.html">Threat hunting II: SSH Honeypot setup</a></li>
            <li class="" data-nav-id="/posts/sans_for608/index.html"><a class="padding" href="/posts/sans_for608/index.html">SANS FOR608</a></li>
            <li class="" data-nav-id="/posts/openbsdzen/index.html"><a class="padding" href="/posts/openbsdzen/index.html">OpenBSD and Zen</a></li></ul></li>
            <li class="" data-nav-id="/about/index.html"><a class="padding" href="/about/index.html">About</a></li>
          </ul>
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-shortcuts">
          <ul class="space collapsible-menu">
          </ul>
        </div>
        <div id="R-footer-margin"></div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-footercontrols">
          <ul class="">
            <li class="R-variantswitcher">
              <div class="padding menu-control">
                <i class="fa-fw fas fa-paint-brush"></i>
                <span>&nbsp;</span>
                <div class="control-style">
                  <label class="a11y-only" for="R-select-variant">Theme</label>
                  <select id="R-select-variant">
                    <option id="R-select-variant-auto" value="auto" selected>Auto</option>
                    <option id="R-select-variant-neon" value="neon">Neon</option>
                  </select>
                </div>
                <div class="clear"></div>
              </div>
              <script>window.relearn.markVariant();</script>
            </li>
          </ul>
        </div>
<div id="R-footer"><p>Built with <a href="https://github.com/McShelby/hugo-theme-relearn" title="love"><i class="fas fa-heart"></i></a> by <a href="https://gohugo.io/">Hugo</a></p></div>
      </div>
    </aside>
    <script src="/js/clipboard/clipboard.min.js?1753094648" defer></script>
    <script src="/js/perfect-scrollbar/perfect-scrollbar.min.js?1753094648" defer></script>
    <script src="/js/theme.js?1753094648" defer></script>
  </body>
</html>
