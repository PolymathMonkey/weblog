<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article" data-r-output-format="html">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.142.0">
    <meta name="generator" content="Relearn 8.0.0+9803d5122ebb3276acea823f476e9eb44f607862">
    <meta name="description" content="Introduction What is Cowrie? Why Podman over Docker? Preconditions / System setup Ubuntu Installed on Raspberry Pi 4&#43; System Fully Updated Podman installed and working VLAN Tagging Configured on Network Interface Setup environment, install cowrie as container and adjust configuration üêß Create a Dedicated User for Cowrie (No Login Shell) üê≥ Pull and Configure Cowrie with Podman üõ† cowrie.cfg ‚Äì Basic Overview üöÄ Run Cowrie Container as ‚Äòcowrie‚Äô User üéØ Operating the Honeypot üîÑ Automatically Restart Cowrie Podman Container with systemd üîí Security Notes Log Forwarding with Filebeat üì¶ Install Filebeat on Ubuntu ‚öô Configure and test Filebeat üöÄ Start and Enable Filebeat üéØ TL;DR ‚Äì What Did We Just Do? Whats next Introduction This post provides a brief walkthrough of how to deploy a lightweight, containerized SSH honeypot using Cowrie and Podman, with the goal of capturing and analyzing malicious activity as part of my threat hunting strategy.">
    <meta name="author" content="Dirk">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Threat hunting II: SSH Honeypot setup - Forensic wheels">
    <meta name="twitter:description" content="Introduction What is Cowrie? Why Podman over Docker? Preconditions / System setup Ubuntu Installed on Raspberry Pi 4&#43; System Fully Updated Podman installed and working VLAN Tagging Configured on Network Interface Setup environment, install cowrie as container and adjust configuration üêß Create a Dedicated User for Cowrie (No Login Shell) üê≥ Pull and Configure Cowrie with Podman üõ† cowrie.cfg ‚Äì Basic Overview üöÄ Run Cowrie Container as ‚Äòcowrie‚Äô User üéØ Operating the Honeypot üîÑ Automatically Restart Cowrie Podman Container with systemd üîí Security Notes Log Forwarding with Filebeat üì¶ Install Filebeat on Ubuntu ‚öô Configure and test Filebeat üöÄ Start and Enable Filebeat üéØ TL;DR ‚Äì What Did We Just Do? Whats next Introduction This post provides a brief walkthrough of how to deploy a lightweight, containerized SSH honeypot using Cowrie and Podman, with the goal of capturing and analyzing malicious activity as part of my threat hunting strategy.">
    <meta property="og:url" content="http://localhost:1313/posts/theathuntinghoneypot/index.html">
    <meta property="og:site_name" content="Forensic wheels">
    <meta property="og:title" content="Threat hunting II: SSH Honeypot setup - Forensic wheels">
    <meta property="og:description" content="Introduction What is Cowrie? Why Podman over Docker? Preconditions / System setup Ubuntu Installed on Raspberry Pi 4&#43; System Fully Updated Podman installed and working VLAN Tagging Configured on Network Interface Setup environment, install cowrie as container and adjust configuration üêß Create a Dedicated User for Cowrie (No Login Shell) üê≥ Pull and Configure Cowrie with Podman üõ† cowrie.cfg ‚Äì Basic Overview üöÄ Run Cowrie Container as ‚Äòcowrie‚Äô User üéØ Operating the Honeypot üîÑ Automatically Restart Cowrie Podman Container with systemd üîí Security Notes Log Forwarding with Filebeat üì¶ Install Filebeat on Ubuntu ‚öô Configure and test Filebeat üöÄ Start and Enable Filebeat üéØ TL;DR ‚Äì What Did We Just Do? Whats next Introduction This post provides a brief walkthrough of how to deploy a lightweight, containerized SSH honeypot using Cowrie and Podman, with the goal of capturing and analyzing malicious activity as part of my threat hunting strategy.">
    <meta property="og:locale" content="en_us">
    <meta property="og:type" content="article">
    <meta property="article:section" content="Forensic wheels">
    <meta property="article:published_time" content="2025-07-13T07:38:00+02:00">
    <meta property="article:modified_time" content="2025-09-29T07:12:38+02:00">
    <meta property="article:tag" content="Threathunting">
    <meta property="article:tag" content="Honeypot">
    <meta itemprop="name" content="Threat hunting II: SSH Honeypot setup - Forensic wheels">
    <meta itemprop="description" content="Introduction What is Cowrie? Why Podman over Docker? Preconditions / System setup Ubuntu Installed on Raspberry Pi 4&#43; System Fully Updated Podman installed and working VLAN Tagging Configured on Network Interface Setup environment, install cowrie as container and adjust configuration üêß Create a Dedicated User for Cowrie (No Login Shell) üê≥ Pull and Configure Cowrie with Podman üõ† cowrie.cfg ‚Äì Basic Overview üöÄ Run Cowrie Container as ‚Äòcowrie‚Äô User üéØ Operating the Honeypot üîÑ Automatically Restart Cowrie Podman Container with systemd üîí Security Notes Log Forwarding with Filebeat üì¶ Install Filebeat on Ubuntu ‚öô Configure and test Filebeat üöÄ Start and Enable Filebeat üéØ TL;DR ‚Äì What Did We Just Do? Whats next Introduction This post provides a brief walkthrough of how to deploy a lightweight, containerized SSH honeypot using Cowrie and Podman, with the goal of capturing and analyzing malicious activity as part of my threat hunting strategy.">
    <meta itemprop="datePublished" content="2025-07-13T07:38:00+02:00">
    <meta itemprop="dateModified" content="2025-09-29T07:12:38+02:00">
    <meta itemprop="wordCount" content="2145">
    <meta itemprop="keywords" content="Threathunting,Honeypot">
    <title>Threat hunting II: SSH Honeypot setup - Forensic wheels</title>
    <link href="/images/logo.svg?1759123130" rel="icon" type="image/svg+xml">
    <link href="/css/auto-complete/auto-complete.min.css?1759123130" rel="stylesheet">
    <script src="/js/auto-complete/auto-complete.min.js?1759123130" defer></script>
    <script src="/js/search-lunr.js?1759123130" defer></script>
    <script src="/js/search.js?1759123130" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.index_js_url="/searchindex.en.js?1759123130";
    </script>
    <script src="/js/lunr/lunr.min.js?1759123130" defer></script>
    <script src="/js/lunr/lunr.stemmer.support.min.js?1759123130" defer></script>
    <script src="/js/lunr/lunr.multi.min.js?1759123130" defer></script>
    <script src="/js/lunr/lunr.en.min.js?1759123130" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.contentLangs=['en'];
    </script>
    <link href="/fonts/fontawesome/css/fontawesome-all.min.css?1759123130" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/fonts/fontawesome/css/fontawesome-all.min.css?1759123130" rel="stylesheet"></noscript>
    <link href="/css/perfect-scrollbar/perfect-scrollbar.min.css?1759123130" rel="stylesheet">
    <link href="/css/theme.css?1759123130" rel="stylesheet">
    <link href="/css/format-html.css?1759123130" rel="stylesheet" id="R-format-style">
    <script>
      window.relearn = window.relearn || {};
      // configuration
      window.relearn.min = ``;
      window.relearn.path='\/posts\/theathuntinghoneypot\/index.html';
      window.relearn.relBasePath='..\/..';
      window.relearn.relBaseUri='..\/..';
      window.relearn.absBaseUri='http:\/\/localhost:1313';
      window.relearn.disableAnchorCopy=false;
      window.relearn.disableAnchorScrolling=false;
      window.relearn.disableInlineCopyToClipboard=false;
      window.relearn.enableBlockCodeWrap=true;
      // legal
      window.relearn.getItem = (s,n) => {return s.getItem(n)};
      window.relearn.setItem = (s,n,v) => {return s.setItem(n,v)};
      window.relearn.removeItem = (s,n) => {return s.removeItem(n)};
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
      // variant stuff
      window.relearn.themevariants = [ 'auto', 'neon' ];
      window.relearn.customvariantname = "my-custom-variant";
      window.relearn.changeVariant = function(variant) {
        var oldVariant = document.documentElement.dataset.rThemeVariant;
        window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        document.documentElement.dataset.rThemeVariant = variant;
        if (oldVariant != variant) {
          document.dispatchEvent( new CustomEvent('themeVariantLoaded', { detail: { variant, oldVariant } }) );
          window.relearn.markVariant();
        }
      }
      window.relearn.markVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant");
        document.querySelectorAll(".R-variantswitcher select").forEach((select) => {select.value = variant;});
      }
      window.relearn.initVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant") ?? "";
        if( variant == window.relearn.customvariantname ){
        }else if( !variant || !window.relearn.themevariants.includes(variant) ){
          variant = window.relearn.themevariants[0];
          window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        }
        document.documentElement.dataset.rThemeVariant = variant;
      }
      window.relearn.initVariant();
      window.relearn.markVariant();
    </script>
  </head>
  <body class="mobile-support html" data-url="/posts/theathuntinghoneypot/index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>
            <div class="topbar-button topbar-button-toc" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="Table of Contents (CTRL&#43;ALT&#43;t)"><i class="fa-fw fas fa-list-alt"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
<nav class="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#what-is-cowrie">What is Cowrie?</a></li>
    <li><a href="#why-podman-over-docker">Why Podman over Docker?</a></li>
    <li><a href="#preconditions-system-setup">Preconditions / System setup</a>
      <ul>
        <li><a href="#ubuntu-installed-on-raspberry-pi-4-plus">Ubuntu Installed on Raspberry Pi 4+</a></li>
        <li><a href="#system-fully-updated">System Fully Updated</a></li>
        <li><a href="#podman-installed-and-working">Podman installed and working</a></li>
        <li><a href="#vlan-tagging-configured-on-network-interface">VLAN Tagging Configured on Network Interface</a></li>
      </ul>
    </li>
    <li><a href="#setup-environment-install-cowrie-as-container-and-adjust-configuration">Setup environment, install cowrie as container and adjust configuration</a>
      <ul>
        <li><a href="#create-a-dedicated-user-for-cowrie--no-login-shell">üêß Create a Dedicated User for Cowrie (No Login Shell)</a></li>
        <li><a href="#pull-and-configure-cowrie-with-podman">üê≥ Pull and Configure Cowrie with Podman</a></li>
        <li><a href="#cowrie-dot-cfg-basic-overview">üõ† cowrie.cfg ‚Äì Basic Overview</a></li>
        <li><a href="#run-cowrie-container-as-cowrie-user">üöÄ Run Cowrie Container as &lsquo;cowrie&rsquo; User</a></li>
        <li><a href="#operating-the-honeypot">üéØ Operating the Honeypot</a></li>
        <li><a href="#automatically-restart-cowrie-podman-container-with-systemd">üîÑ Automatically Restart Cowrie Podman Container with systemd</a></li>
        <li><a href="#security-notes">üîí Security Notes</a></li>
      </ul>
    </li>
    <li><a href="#log-forwarding-with-filebeat">Log Forwarding with Filebeat</a>
      <ul>
        <li><a href="#install-filebeat-on-ubuntu">üì¶ Install Filebeat on Ubuntu</a></li>
        <li><a href="#configure-and-test-filebeat">‚öô Configure and test Filebeat</a></li>
        <li><a href="#start-and-enable-filebeat">üöÄ Start and Enable Filebeat</a></li>
      </ul>
    </li>
    <li><a href="#tl-dr-what-did-we-just-do">üéØ TL;DR ‚Äì What Did We Just Do?</a></li>
    <li><a href="#whats-next">Whats next</a></li>
  </ul>
</nav>
                </div>
              </div>
            </div>
          </div>
          <span class="topbar-breadcrumbs highlightable">
            Threat hunting II: SSH Honeypot setup
          </span>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-more" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="More"><i class="fa-fw fas fa-ellipsis-v"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
                  <div class="topbar-area topbar-area-more" data-area="more">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable posts" tabindex="-1">
        <div class="flex-block-wrapper">
<article class="default">
  <header class="headline">
<div class="R-taxonomy taxonomy-tags cstyle tags" title="Tags" style="--VARIABLE-TAGS-BG-color: var(--INTERNAL-TAG-BG-color);">
  <ul>
    <li><a class="term-link" href="/tags/honeypot/index.html">Honeypot</a></li>
    <li><a class="term-link" href="/tags/threathunting/index.html">Threathunting</a></li>
  </ul>
</div>
  </header>

<h1 id="threat-hunting-ii-ssh-honeypot-setup">Threat hunting II: SSH Honeypot setup</h1>

<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<ul>
<li><a href="/posts/theathuntinghoneypot/index.html#introduction">Introduction</a></li>
<li><a href="/posts/theathuntinghoneypot/index.html#what-is-cowrie">What is Cowrie?</a></li>
<li><a href="/posts/theathuntinghoneypot/index.html#why-podman-over-docker">Why Podman over Docker?</a></li>
<li><a href="/posts/theathuntinghoneypot/index.html#preconditions-system-setup">Preconditions / System setup</a>
<ul>
<li><a href="/posts/theathuntinghoneypot/index.html#ubuntu-installed-on-raspberry-pi-4-plus">Ubuntu Installed on Raspberry Pi 4+</a></li>
<li><a href="/posts/theathuntinghoneypot/index.html#system-fully-updated">System Fully Updated</a></li>
<li><a href="/posts/theathuntinghoneypot/index.html#podman-installed-and-working">Podman installed and working</a></li>
<li><a href="/posts/theathuntinghoneypot/index.html#vlan-tagging-configured-on-network-interface">VLAN Tagging Configured on Network Interface</a></li>
</ul>
</li>
<li><a href="/posts/theathuntinghoneypot/index.html#setup-environment-install-cowrie-as-container-and-adjust-configuration">Setup environment, install cowrie as container and adjust configuration</a>
<ul>
<li><a href="/posts/theathuntinghoneypot/index.html#create-a-dedicated-user-for-cowrie--no-login-shell">üêß Create a Dedicated User for Cowrie (No Login Shell)</a></li>
<li><a href="/posts/theathuntinghoneypot/index.html#pull-and-configure-cowrie-with-podman">üê≥ Pull and Configure Cowrie with Podman</a></li>
<li><a href="/posts/theathuntinghoneypot/index.html#cowrie-dot-cfg-basic-overview">üõ† cowrie.cfg ‚Äì Basic Overview</a></li>
<li><a href="/posts/theathuntinghoneypot/index.html#run-cowrie-container-as-cowrie-user">üöÄ Run Cowrie Container as &lsquo;cowrie&rsquo; User</a></li>
<li><a href="/posts/theathuntinghoneypot/index.html#operating-the-honeypot">üéØ Operating the Honeypot</a></li>
<li><a href="/posts/theathuntinghoneypot/index.html#automatically-restart-cowrie-podman-container-with-systemd">üîÑ Automatically Restart Cowrie Podman Container with systemd</a></li>
<li><a href="/posts/theathuntinghoneypot/index.html#security-notes">üîí Security Notes</a></li>
</ul>
</li>
<li><a href="/posts/theathuntinghoneypot/index.html#log-forwarding-with-filebeat">Log Forwarding with Filebeat</a>
<ul>
<li><a href="/posts/theathuntinghoneypot/index.html#install-filebeat-on-ubuntu">üì¶ Install Filebeat on Ubuntu</a></li>
<li><a href="/posts/theathuntinghoneypot/index.html#configure-and-test-filebeat">‚öô Configure and test Filebeat</a></li>
<li><a href="/posts/theathuntinghoneypot/index.html#start-and-enable-filebeat">üöÄ Start and Enable Filebeat</a></li>
</ul>
</li>
<li><a href="/posts/theathuntinghoneypot/index.html#tl-dr-what-did-we-just-do">üéØ TL;DR ‚Äì What Did We Just Do?</a></li>
<li><a href="/posts/theathuntinghoneypot/index.html#whats-next">Whats next</a></li>
</ul>
<!-- raw HTML omitted -->
<h2 id="introduction">Introduction</h2>
<p>This post provides a brief walkthrough of how to deploy a lightweight,
containerized SSH honeypot using Cowrie and Podman, with the goal of
capturing and analyzing malicious activity as part of my threat hunting
strategy.</p>
<h2 id="what-is-cowrie">What is Cowrie?</h2>
<p>Cowrie is an interactive SSH and Telnet honeypot designed to emulate a
real system, capturing attacker behavior in a controlled environment.
It allows defenders and researchers to observe malicious activity without
exposing actual infrastructure.</p>
<p><!-- raw HTML omitted -->Key capabilities of Cowrie include<!-- raw HTML omitted --></p>
<ul>
<li>
<p><strong>Full session logging</strong>: Records all commands entered by the attacker,
along with input/output streams and timing data. Sessions can be saved
as plaintext or in formats suitable for replay.</p>
</li>
<li>
<p><strong>Fake file system and shell environment</strong>: Emulates a basic Linux shell
with a user-modifiable file system. Attackers can navigate directories,
read/write fake files, or attempt to download/upload payloads.</p>
</li>
<li>
<p><strong>Command emulation</strong>: Supports a large set of common Unix commands (`ls`,
`cat`, `wget`, etc.), allowing attackers to interact naturally, as
if on a real system. And can be extended with more commands</p>
</li>
<li>
<p><strong>Credential logging</strong>: Captures usernames and passwords used in
brute-force login attempts or interactive logins.</p>
</li>
<li>
<p><strong>File download capture</strong>: Logs and optionally stores any files attackers
attempt to retrieve via `wget`, `curl`, or similar tools.</p>
</li>
<li>
<p><strong>JSON-formatted logging and integration&rsquo;s</strong>: Outputs structured logs that
are easy to parse and ingest into systems like ELK, Splunk, or custom
analysis pipelines.</p>
</li>
</ul>
<p>Cowrie is widely used in research, threat intelligence, and proactive defense
efforts to gather Indicators of Compromise (IOCs) and understand attacker
tactics,techniques, and procedures (TTPs).</p>
<h2 id="why-podman-over-docker">Why Podman over Docker?</h2>
<p>Podman offers several advantages over Docker, particularly in terms of security
and system integration. It supports rootless containers, allowing users to run
containers without elevated privileges, which reduces the attack surface.</p>
<p>Podman is daemon-less, integrating more seamlessly with systemd and existing
Linux workflows. Additionally, Podman is fully compatible with the Open
Container Initiative (OCI) standards, ensuring interoperability and
flexibility across container ecosystems.</p>
<h2 id="preconditions-system-setup">Preconditions / System setup</h2>
<p>Before I proceed with the cowrie setup, I made sure the following preconditions are met:</p>
<h3 id="ubuntu-installed-on-raspberry-pi-4-plus">Ubuntu Installed on Raspberry Pi 4+</h3>
<p>I am using a Raspberry Pi 4+ running Ubuntu</p>
<h3 id="system-fully-updated">System Fully Updated</h3>
<p>After installation, I made sure system is up to date:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo apt update <span style="color:#f92672">&amp;&amp;</span> sudo apt upgrade -y</span></span></code></pre></div>
<h3 id="podman-installed-and-working">Podman installed and working</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e"># Ubuntu 20.10 and newer</span>
</span></span><span style="display:flex;"><span>sudo apt-get -y install podman</span></span></code></pre></div>
<p>Run the Hello World Container.In this moment I did not had the cowrie user yet
setup so I used my system user to test</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>podman run hello-world
</span></span><span style="display:flex;"><span>Trying to pull docker.io/library/hello-world:latest...
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>Hello from Docker!
</span></span><span style="display:flex;"><span>This message shows that your installation appears to be working correctly.</span></span></code></pre></div>
<p>tho sometimes the pulling fails like that then I had to put `docker.io` in
front of the container name like:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>podman run docker.io/hello-world</span></span></code></pre></div>
<p>then it would work for sure.</p>
<h3 id="vlan-tagging-configured-on-network-interface">VLAN Tagging Configured on Network Interface</h3>
<p>In my network setup for threathunting the honeypot requires VLAN tagging to
configured to reachable from the outside, VLAN210 is my restricted Network.
Therefore i needed to configure the vlan using <code>nmcli</code> so it&rsquo;s persistent across reboots.</p>
<h4 id="example-create-a-vlan-interface--e-dot-g-dot-vlan-id-210-on-main-if">Example: Create a VLAN interface (e.g., VLAN ID 210 on main if)</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo nmcli con add type vlan con-name vlan210 dev mainif id <span style="color:#ae81ff">210</span> ip4 192.168.210.3/24 gw4 192.168.210.1
</span></span><span style="display:flex;"><span>sudo nmcli con up vlan210</span></span></code></pre></div>
<ul>
<li><code>con-name vlan210</code>: Name of the new VLAN connection.</li>
<li><code>dev mainif</code>: Physical interface to tag.</li>
<li><code>id 210</code>: VLAN ID.</li>
<li><code>ip4</code>, <code>gw4</code>: Optional IP and gateway assignment.</li>
</ul>
<p>This will persist the configuration and activate the VLAN interface
immediately. Next I moved on to Install the honeypot.</p>
<hr>
<h2 id="setup-environment-install-cowrie-as-container-and-adjust-configuration">Setup environment, install cowrie as container and adjust configuration</h2>
<h3 id="create-a-dedicated-user-for-cowrie--no-login-shell">üêß Create a Dedicated User for Cowrie (No Login Shell)</h3>
<p>Running the Podman container under a dedicated system user with no login shell
is a recommended security best practice. Reasons include:</p>
<ul>
<li>
<p><strong><strong>Privilege Separation:</strong></strong>
Isolates the container from other system processes and users, limiting
the potential impact of a compromise.</p>
</li>
<li>
<p><strong><strong>Reduced Attack Surface:</strong></strong>
The user has no login shell (e.g., <code>/usr/sbin/nologin</code>), meaning it can&rsquo;t be
used to log into the system interactively.</p>
</li>
<li>
<p><strong><strong>Auditing &amp; Logging:</strong></strong>
Helps distinguish container activity in system logs and process lists,
making monitoring easier.</p>
</li>
<li>
<p><strong><strong>Least Privilege Principle:</strong></strong>
The user has only the permissions necessary to run the container ‚Äî nothing more.</p>
</li>
</ul>
<p><strong><strong>1. Create the &lsquo;cowrie&rsquo; user (no home directory, no login shell)</strong></strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>sudo useradd --system --no-create-home --shell /usr/sbin/nologin cowrie</span></span></code></pre></div>
<p><strong><strong>2. Create necessary directories and set ownership</strong></strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>sudo mkdir -p /opt/cowrie/etc
</span></span><span style="display:flex;"><span>sudo mkdir -p /opt/cowrie/var
</span></span><span style="display:flex;"><span>sudo mkdir -p /opt/cowrie/var/log/cowrie
</span></span><span style="display:flex;"><span>sudo chown -R cowrie:cowrie /opt/cowrie</span></span></code></pre></div>
<h3 id="pull-and-configure-cowrie-with-podman">üê≥ Pull and Configure Cowrie with Podman</h3>
<p><strong><strong>3. As the cowrie user, pull the container image</strong></strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo -u cowrie podman pull docker.io/cowrie/cowrie</span></span></code></pre></div>
<p><strong><strong>4. Copy default config file into persistent volume</strong></strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo -u cowrie podman run --rm localhost/cowrie_honeypot:latest <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  cat /cowrie/cowrie-git/etc/cowrie.cfg.dist &gt; /opt/cowrie/etc/cowrie.cfg</span></span></code></pre></div>
<h3 id="cowrie-dot-cfg-basic-overview">üõ† cowrie.cfg ‚Äì Basic Overview</h3>
<p>The `cowrie.cfg` file is the main configuration for <strong><strong>Cowrie</strong></strong>, the SSH/Telnet
honeypot we use. It uses INI-style syntax and is divided into sections. Each section
begins with a header like <strong>[section_name]</strong>.</p>
<ul>
<li>
<p>üìÅ Key Sections &amp; Settings</p>
<p><strong><strong>[ssh]</strong></strong></p>
<ul>
<li>Enable or disable SSH/Telnet and set the port to listen on::
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>enabled <span style="color:#f92672">=</span> true
</span></span><span style="display:flex;"><span>listen_port <span style="color:#f92672">=</span> <span style="color:#ae81ff">2222</span></span></span></code></pre></div>
</li>
</ul>
<p><strong><strong>[honeypot]</strong></strong></p>
<ul>
<li>
<p>Set honeypot host name and logpath properties:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>hostname <span style="color:#f92672">=</span> cowrie-host
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Directory where to save log files in.</span>
</span></span><span style="display:flex;"><span>log_path <span style="color:#f92672">=</span> var/log/cowrie</span></span></code></pre></div>
</li>
<li>
<p>Define login behavior:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>auth_class <span style="color:#f92672">=</span> AuthRandom
</span></span><span style="display:flex;"><span>auth_class_parameters <span style="color:#f92672">=</span> 1, 5, <span style="color:#ae81ff">10</span></span></span></code></pre></div>
<p>I use AuthRandom here which causes to allow access after &ldquo;randint(2,5)&rdquo;
attempts. This means the threat actor will fail with some logins and some
will be logged in immediately.</p>
</li>
</ul>
<p><strong><strong>[output_jsonlog]</strong></strong></p>
<ul>
<li>Configure logging and output plugins:
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#f92672">[</span>output_jsonlog<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>enabled <span style="color:#f92672">=</span> true
</span></span><span style="display:flex;"><span>logfile <span style="color:#f92672">=</span> <span style="color:#e6db74">${</span>honeypot:log_path<span style="color:#e6db74">}</span>/cowrie.json
</span></span><span style="display:flex;"><span>epoch_timestamp <span style="color:#f92672">=</span> false</span></span></code></pre></div>
This sets the default log location in the file-system, this is important so that file beat later can
pickup on the juicy honeypot log files.</li>
</ul>
<p>This is the whole configuration needed to run the honeypot.</p>
<p><!-- raw HTML omitted -->üìå Notes<!-- raw HTML omitted --></p>
<ul>
<li>Restart Cowrie after configuration changes.</li>
<li>The configuration can be split across multiple `.cfg` files in `cowrie.cfg.d/` for modular setup.</li>
</ul>
</li>
</ul>
<h3 id="run-cowrie-container-as-cowrie-user">üöÄ Run Cowrie Container as &lsquo;cowrie&rsquo; User</h3>
<p>Once I had created the dedicated system user (see earlier section), I
was able to run the Cowrie container with Podman using <code>sudo -u</code> and UID mapping.</p>
<h4 id="step-by-step-command-explanation">Step-by-Step Command explanation</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo -u cowrie podman run -d --name cowrie <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --uidmap 0:999:1001 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -v /opt/cowrie/etc:/cowrie/cowrie-git/etc:Z <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -v /opt/cowrie/var:/cowrie/cowrie-git/var:Z <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  -p 2222:2222 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  cowrie/cowrie</span></span></code></pre></div>
<h4 id="explanation">Explanation</h4>
<ul>
<li><code>sudo -u cowrie</code>: Runs the Podman command as the unprivileged <code>cowrie</code> user.</li>
<li><code>--uidmap 0:999:1001</code>: Maps root (UID 0) <strong><strong>inside</strong></strong> the container to the <code>cowrie</code> UID on the host.</li>
<li><code>-v /opt/cowrie/etc</code> and <code>/opt/cowrie/var</code>: Mounts configuration and data volumes from the host with `:Z` to apply correct SELinux labels (optional on systems without SELinux).</li>
<li><code>-p 2222:2222</code>: Forwards port 2222 from host to container (Cowrie&rsquo;s SSH honeypot port).</li>
<li><code>cowrie/cowrie</code>: The container image name (use latest or specific tag as needed).</li>
</ul>
<h4 id="benefits">Benefits:</h4>
<ul>
<li>
<p><strong><strong>Container runs as non-root on the host:</strong></strong>
Even if a process inside the container thinks it&rsquo;s root, it&rsquo;s actually limited to the unprivileged <code>cowrie</code> user outside the container.</p>
</li>
<li>
<p><strong><strong>Enhanced security:</strong></strong>
If the container is compromised, the attacker only gets access as the <code>cowrie</code> user ‚Äî not real root.</p>
</li>
<li>
<p><strong><strong>Avoids root-equivalent risks:</strong></strong>
Prevents privilege escalation or access to sensitive host files and devices.</p>
</li>
</ul>
<h3 id="operating-the-honeypot">üéØ Operating the Honeypot</h3>
<ul>
<li>
<p><strong><strong>View logs</strong></strong>
I think to know how to debug the container is important so we start first
with the logs:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>sudo -u cowrie podman logs -f cowrie
</span></span><span style="display:flex;"><span>...snip...
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>HoneyPotSSHTransport,14,10.0.2.100<span style="color:#f92672">]</span> Closing TTY Log: var/lib/cowrie/tty/e52d9c508c502347344d8c07ad91cbd6068afc75ff6292f062a09ca381c89e71 after 0.8 seconds
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>cowrie.ssh.connection.CowrieSSHConnection#info<span style="color:#f92672">]</span> sending close <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>cowrie.ssh.session.HoneyPotSSHSession#info<span style="color:#f92672">]</span> remote close
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>HoneyPotSSHTransport,14,10.0.2.100<span style="color:#f92672">]</span> Got remote error, code <span style="color:#ae81ff">11</span> reason: b<span style="color:#e6db74">&#39;disconnected by user&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>HoneyPotSSHTransport,14,10.0.2.100<span style="color:#f92672">]</span> avatar root logging out
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>cowrie.ssh.transport.HoneyPotSSHTransport#info<span style="color:#f92672">]</span> connection lost
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>HoneyPotSSHTransport,14,10.0.2.100<span style="color:#f92672">]</span> Connection lost after 2.8 seconds
</span></span><span style="display:flex;"><span>...snip...</span></span></code></pre></div>
</li>
<li>
<p><strong><strong>Restart container</strong></strong>
If things go left just restart that thing:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo -u cowrie podman restart cowrie</span></span></code></pre></div>
<p>In the logs you can see that cowrie is running and accepting SSH connections:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>...snip...
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> CowrieSSHFactory starting on <span style="color:#ae81ff">2222</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>cowrie.ssh.factory.CowrieSSHFactory#info<span style="color:#f92672">]</span> Starting factory &lt;cowrie.ssh.factory.CowrieSSHFactory object at 0x7fb66f26d0&gt;
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>-<span style="color:#f92672">]</span> Ready to accept SSH connections
</span></span><span style="display:flex;"><span>...snip...</span></span></code></pre></div>
<p>When the log says &ldquo;Ready to accept SSH connections&rdquo; I tested if I could login:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>ssh 192.168.210.3 -p <span style="color:#ae81ff">2222</span> -l root
</span></span><span style="display:flex;"><span>root@192.168.210.3 password:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>The programs included with the Debian GNU/Linux system are free software;
</span></span><span style="display:flex;"><span>the exact distribution terms <span style="color:#66d9ef">for</span> each program are described in the
</span></span><span style="display:flex;"><span>individual files in /usr/share/doc/*/copyright.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
</span></span><span style="display:flex;"><span>permitted by applicable law.
</span></span><span style="display:flex;"><span>root@svr04:~# uname -a
</span></span><span style="display:flex;"><span>Linux svr04 3.2.0-4-amd64 <span style="color:#75715e">#1 SMP Debian 3.2.68-1+deb7u1 x86_64 GNU/Linux</span>
</span></span><span style="display:flex;"><span>root@svr04:~#</span></span></code></pre></div>
</li>
<li>
<p><strong><strong>Stop container</strong></strong>
Nothing special here:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo -u cowrie podman stop cowrie</span></span></code></pre></div>
</li>
</ul>
<hr>
<h3 id="automatically-restart-cowrie-podman-container-with-systemd">üîÑ Automatically Restart Cowrie Podman Container with systemd</h3>
<p>To keep your Cowrie container running reliably and restart it if it stops, use a systemd service with restart policies.
Please make sure to double check this part on your side as I am no systemd
expert at all, for me this just worked.</p>
<h4 id="step-1-generate-a-systemd-service-file">Step 1: Generate a systemd Service File</h4>
<p>Create `/etc/systemd/system/cowrie-container.service` with the following
content:
You can create the systemd file with the command:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>sudo -u cowrie podman generate systemd --name cowrie --files --restart-policy<span style="color:#f92672">=</span>on-failure</span></span></code></pre></div>
<p>The resulting file looks somewhat like this</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#75715e"># container-cowrie.service</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># autogenerated by Podman 4.3.1</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Fri Sep 19 10:27:47 CEST 2025</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>Unit<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>Description<span style="color:#f92672">=</span>Podman container-cowrie.service
</span></span><span style="display:flex;"><span>Documentation<span style="color:#f92672">=</span>man:podman-generate-systemd<span style="color:#f92672">(</span>1<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Wants<span style="color:#f92672">=</span>network-online.target
</span></span><span style="display:flex;"><span>After<span style="color:#f92672">=</span>network-online.target
</span></span><span style="display:flex;"><span>RequiresMountsFor<span style="color:#f92672">=</span>/run/user/1001/containers
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>Service<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>User<span style="color:#f92672">=</span>cowrie
</span></span><span style="display:flex;"><span>Group<span style="color:#f92672">=</span>cowrie
</span></span><span style="display:flex;"><span>Restart<span style="color:#f92672">=</span>on-failure
</span></span><span style="display:flex;"><span>Environment<span style="color:#f92672">=</span>PODMAN_SYSTEMD_UNIT<span style="color:#f92672">=</span>%n
</span></span><span style="display:flex;"><span>Restart<span style="color:#f92672">=</span>on-failure
</span></span><span style="display:flex;"><span>TimeoutStopSec<span style="color:#f92672">=</span><span style="color:#ae81ff">70</span>
</span></span><span style="display:flex;"><span>ExecStart<span style="color:#f92672">=</span>/usr/bin/podman start -a cowrie
</span></span><span style="display:flex;"><span>ExecStop<span style="color:#f92672">=</span>/usr/bin/podman stop -t <span style="color:#ae81ff">10</span> cowrie
</span></span><span style="display:flex;"><span>ExecStopPost<span style="color:#f92672">=</span>/usr/bin/podman stop -t <span style="color:#ae81ff">10</span> cowrie
</span></span><span style="display:flex;"><span>Type<span style="color:#f92672">=</span>forking
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>Install<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>WantedBy<span style="color:#f92672">=</span>default.target</span></span></code></pre></div>
<ul>
<li>The `&ndash;restart-policy=on-failure` makes systemd restart the container if it exits with a failure.</li>
</ul>
<h4 id="step-2-enable-the-service">Step 2: Enable the Service</h4>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo systemctl daemon-reload
</span></span><span style="display:flex;"><span>sudo systemctl enable --now cowrie-container.service</span></span></code></pre></div>
<h4 id="step-3--optional--add-a-health-check-script">Step 3: (Optional) Add a Health Check Script</h4>
<p>To detect if Cowrie stops accepting connections even if the container is still running, create a health check script running as <code>cowrie</code>:</p>
<p>Create `/usr/local/bin/check_cowrie.sh`:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span> ! nc -z localhost 2222; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>  echo <span style="color:#e6db74">&#34;Cowrie not responding, restarting container&#34;</span>
</span></span><span style="display:flex;"><span>  /usr/bin/podman restart cowrie
</span></span><span style="display:flex;"><span>  /usr/local/bin/pushover.sh <span style="color:#e6db74">&#34;Cowrie was restarted!&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span></span></span></code></pre></div>
<p>This restarts the service and sends out a notification via pushover.</p>
<p>Make it executable:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo chmod +x /usr/local/bin/check_cowrie.sh
</span></span><span style="display:flex;"><span>sudo chown cowrie:cowrie /usr/local/bin/check_cowrie.sh</span></span></code></pre></div>
<p>Create systemd service `/etc/systemd/system/check_cowrie.service`:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#66d9ef">[Unit]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Description</span><span style="color:#f92672">=</span><span style="color:#e6db74">Check Cowrie honeypot health</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">[Service]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">User</span><span style="color:#f92672">=</span><span style="color:#e6db74">cowrie</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Group</span><span style="color:#f92672">=</span><span style="color:#e6db74">cowrie</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Type</span><span style="color:#f92672">=</span><span style="color:#e6db74">oneshot</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">ExecStart</span><span style="color:#f92672">=</span><span style="color:#e6db74">/usr/local/bin/check_cowrie.sh</span></span></span></code></pre></div>
<p>Create systemd timer `/etc/systemd/system/check_cowrie.timer`:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-ini" data-lang="ini"><span style="display:flex;"><span><span style="color:#66d9ef">[Unit]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Description</span><span style="color:#f92672">=</span><span style="color:#e6db74">Run Cowrie health check every minute</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">[Timer]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">OnBootSec</span><span style="color:#f92672">=</span><span style="color:#e6db74">1min</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">OnUnitActiveSec</span><span style="color:#f92672">=</span><span style="color:#e6db74">1min</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">Unit</span><span style="color:#f92672">=</span><span style="color:#e6db74">check_cowrie.service</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">[Install]</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">WantedBy</span><span style="color:#f92672">=</span><span style="color:#e6db74">timers.target</span></span></span></code></pre></div>
<p>Enable and start the timer:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo systemctl daemon-reload
</span></span><span style="display:flex;"><span>sudo systemctl enable --now check_cowrie.timer</span></span></code></pre></div>
<hr>
<h4 id="summary">Summary</h4>
<ul>
<li>Used Podman‚Äôs systemd integration for automatic restart on container failure.</li>
<li>Added a health check timer to detect if Cowrie stops accepting connections and restart proactively.</li>
</ul>
<h3 id="security-notes">üîí Security Notes</h3>
<ul>
<li>
<p>The `cowrie` user has no login shell (`/usr/sbin/no login`)</p>
</li>
<li>
<p>Running Cowrie isolated via Podman increases containment</p>
</li>
<li>
<p>All files are owned by `cowrie`, no root access required for normal operation</p>
<hr>
</li>
</ul>
<h2 id="log-forwarding-with-filebeat">Log Forwarding with Filebeat</h2>
<h3 id="install-filebeat-on-ubuntu">üì¶ Install Filebeat on Ubuntu</h3>
<p><strong><strong>1. Add Elastic‚Äôs GPG key and repository</strong></strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -fsSL https://artifacts.elastic.co/GPG-KEY-elasticsearch | sudo gpg --dearmor -o /usr/share/keyrings/elastic.gpg
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;deb [signed-by=/usr/share/keyrings/elastic.gpg] https://artifacts.elastic.co/packages/8.x/apt stable main&#34;</span> | <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  sudo tee /etc/apt/sources.list.d/elastic-8.x.list</span></span></code></pre></div>
<p><strong><strong>2. Update APT and install Filebeat</strong></strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo apt install filebeat</span></span></code></pre></div>
<h3 id="configure-and-test-filebeat">‚öô Configure and test Filebeat</h3>
<p><strong><strong>3. Edit Filebeat config</strong></strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo mg /etc/filebeat/filebeat.yml</span></span></code></pre></div>
<p>The filebeat config is straight forward. You have to write a filebeat.input
block which contains the path where the logfiles are you need to ingest. And
at the end the log-destination (logstash) so that filebeat knows where to send
the logs to:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">filebeat.inputs</span>:
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">type</span>: <span style="color:#ae81ff">log</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">paths</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ae81ff">/opt/cowrie/var/log/cowrie/cowrie.json</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">json.keys_under_root</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">json.add_error_key</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">fields</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">source</span>: <span style="color:#ae81ff">cowrie</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">fields_under_root</span>: <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">output.logstash</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">hosts</span>: [<span style="color:#e6db74">&#34;192.168.123.5:5044&#34;</span>]</span></span></code></pre></div>
<p><strong><strong>4. (Optional) Test Filebeat config</strong></strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo filebeat test config
</span></span><span style="display:flex;"><span>logstash: 192.168.210.5:5044...
</span></span><span style="display:flex;"><span>connection...
</span></span><span style="display:flex;"><span>  parse host... OK
</span></span><span style="display:flex;"><span>  dns lookup... OK
</span></span><span style="display:flex;"><span>  addresses: 192.168.210.5
</span></span><span style="display:flex;"><span>  dial up... OK
</span></span><span style="display:flex;"><span>TLS... WARN secure connection disabled
</span></span><span style="display:flex;"><span>talk to server... OK</span></span></code></pre></div>
<h3 id="start-and-enable-filebeat">üöÄ Start and Enable Filebeat</h3>
<p><strong><strong>5. Enable and start Filebeat</strong></strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo systemctl enable filebeat
</span></span><span style="display:flex;"><span>sudo systemctl daemon-reload
</span></span><span style="display:flex;"><span>sudo systemctl start filebeat</span></span></code></pre></div>
<p><strong><strong>6. Check Filebeat status and logs</strong></strong></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo systemctl status filebeat
</span></span><span style="display:flex;"><span>sudo journalctl -u filebeat -f</span></span></code></pre></div>
<hr>
<h2 id="tl-dr-what-did-we-just-do">üéØ TL;DR ‚Äì What Did We Just Do?</h2>
<p><strong><strong>1. We deployed Cowrie like pros.</strong></strong></p>
<ul>
<li>Ran it safely in a Podman container under a non-login user.</li>
<li>No mess, no root, no regrets.</li>
</ul>
<p><strong><strong>2. Logs? Sorted.</strong></strong></p>
<ul>
<li>Filebeat scooped up Cowrie‚Äôs logs and shipped them to Elasticsearch.</li>
<li>Now we can actually <strong>see</strong> who&rsquo;s knocking on the honeypot door.</li>
</ul>
<p><strong><strong>3. Everything‚Äôs persistent.</strong></strong></p>
<ul>
<li>Configs and logs live outside the container. Cowrie forgets nothing‚Äîeven after a reboot.</li>
</ul>
<p><strong><strong>4. Setup is clean and modular.</strong></strong></p>
<ul>
<li>Each part (Cowrie, Filebeat, Elasticsearch) does its job.</li>
<li>Break one, fix one‚Äîno domino disasters.</li>
</ul>
<p><strong><strong>5. It‚Äôs nerdy, useful, and kinda fun.</strong></strong></p>
<ul>
<li>Now I built a mini threat intel system.</li>
<li>Now I can sit back, sip coffee, and watch the kiddies play.</li>
</ul>
<h2 id="whats-next">Whats next</h2>
<p>Next I build the <a href="~/../honeyhttpd">HTTP Honeypot</a></p>
<div id="giscus-comments" style="margin-top: 2rem;">
    <script src="https://giscus.app/client.js"
            data-repo="PolymathMonkey/weblog"
            data-repo-id="R_kgDOOvWS_g"
            data-category="General"
            data-category-id="DIC_kwDOOvWS_s4CsdWD"
            data-mapping="pathname"
            data-theme="dark"
            crossorigin="anonymous"
            async>
    </script>
</div>


  <footer class="footline">
              <i class='fa-fw fas fa-calendar'></i> Jul 13, 2025
<div class="R-taxonomy taxonomy-categories cstyle" title="Categories" style="--VARIABLE-TAGS-BG-color: var(--INTERNAL-TAG-BG-color);">
  <i class="fa-fw fas fa-layer-group"></i>
  <ul>
    <li><a class="term-link" href="/categories/threathunting/index.html">Threathunting</a></li>
  </ul>
</div>
  </footer>
</article>
        </div>
      </main>
    </div>
    <aside id="R-sidebar" class="default-animation">
      <div id="R-header-topbar" class="default-animation"></div>
      <div id="R-header-wrapper" class="default-animation">
        <div id="R-header" class="default-animation">
          <a id="R-logo" class="R-default" href="/index.html">
            <div class="logo-title">Forensic wheels</div>
          </a>
        </div>
        <search><form action="/search/index.html" method="get">
          <div class="searchbox default-animation">
            <button class="search-detail" type="submit" title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
            <label class="a11y-only" for="R-search-by">Search</label>
            <input data-search-input id="R-search-by" name="search-by" class="search-by" type="search" placeholder="Search...">
            <button class="search-clear" type="button" data-search-clear="" title="Clear search"><i class="fas fa-times" title="Clear search"></i></button>
          </div>
        </form></search>
      </div>
      <div id="R-homelinks" class="default-animation">
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-homelinks">
          <ul class="space collapsible-menu">
          </ul>
        </div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-headercontrols">
          <ul class="">
          </ul>
        </div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
      </div>
      <div id="R-content-wrapper" class="highlightable">
        <div class="R-sidebarmenu R-shortcutmenu-main">
          <ul class="enlarge morespace collapsible-menu">
            <li class="parent " data-nav-id="/posts/index.html"><a class="padding" href="/posts/index.html">Forensic wheels</a><ul id="R-subsections-b4e55eb7e39db1aee6d02808a2267090" class="collapsible-menu">
            <li class="" data-nav-id="/posts/threathuntingnet/index.html"><a class="padding" href="/posts/threathuntingnet/index.html">Threathunting I: Network setup</a></li>
            <li class="active " data-nav-id="/posts/theathuntinghoneypot/index.html"><a class="padding" href="/posts/theathuntinghoneypot/index.html">Threat hunting II: SSH Honeypot setup</a></li></ul></li>
            <li class="" data-nav-id="/about/index.html"><a class="padding" href="/about/index.html">about</a></li>
          </ul>
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-shortcuts">
          <ul class="space collapsible-menu">
          </ul>
        </div>
        <div id="R-footer-margin"></div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-footercontrols">
          <ul class="">
            <li class="R-variantswitcher">
              <div class="padding menu-control">
                <i class="fa-fw fas fa-paint-brush"></i>
                <span>&nbsp;</span>
                <div class="control-style">
                  <label class="a11y-only" for="R-select-variant">Theme</label>
                  <select id="R-select-variant">
                    <option id="R-select-variant-auto" value="auto" selected>Auto</option>
                    <option id="R-select-variant-neon" value="neon">Neon</option>
                  </select>
                </div>
                <div class="clear"></div>
              </div>
              <script>window.relearn.markVariant();</script>
            </li>
          </ul>
        </div>
<div id="R-footer"><p>Built with <a href="https://github.com/McShelby/hugo-theme-relearn" title="love"><i class="fas fa-heart"></i></a> by <a href="https://gohugo.io/">Hugo</a></p></div>
      </div>
    </aside>
    <script src="/js/clipboard/clipboard.min.js?1759123130" defer></script>
    <script src="/js/perfect-scrollbar/perfect-scrollbar.min.js?1759123130" defer></script>
    <script src="/js/theme.js?1759123130" defer></script>
  </body>
</html>
